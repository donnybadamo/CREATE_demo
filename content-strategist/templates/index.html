<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microsoft C.R.E.A.T.E. Content Pipeline</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --ms-blue: #0078d4;
            --ms-blue-dark: #106ebe;
            --ms-gray: #605e5c;
            --earth-sage: #87a96b;
            --earth-clay: #d4a574;
            --earth-stone: #9d8f7f;
            --earth-sand: #e6ddd4;
            --earth-forest: #6b7c5a;
            --earth-warm: #f7f4f1;
            --earth-rich: #8b6914;
            --off-white: #fafafa;
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            min-height: 100vh; 
            color: var(--ms-gray); 
            position: relative;
            background: var(--off-white);
        }
        
        /* Microsoft Logo */
        .microsoft-logo {
            position: fixed;
            top: 20px;
            right: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-gap: 2px;
            width: 40px;
            height: 40px;
            z-index: 1500;
        }
        
        .ms-square {
            width: 18px;
            height: 18px;
        }
        
        .ms-square:nth-child(1) { background: #f25022; }
        .ms-square:nth-child(2) { background: #7fba00; }
        .ms-square:nth-child(3) { background: #00a4ef; }
        .ms-square:nth-child(4) { background: #ffb900; }

        /* User Profile Section */
        .user-profile {
            position: fixed;
            top: 20px;
            right: 80px;
            z-index: 1500;
            display: flex;
            align-items: center;
            gap: 12px;
            background: white;
            padding: 8px 16px;
            border-radius: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border: 1px solid #e8e8e8;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--ms-blue);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .user-info {
            display: flex;
            flex-direction: column;
            line-height: 1.2;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--ms-gray);
        }

        .user-email {
            font-size: 0.8rem;
            color: #999;
        }

        /* Home Button */
        .home-button {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1500;
            background: var(--ms-blue);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 120, 212, 0.3);
            display: none;
        }

        .home-button:hover {
            background: var(--ms-blue-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 120, 212, 0.4);
        }

        .home-button.visible {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Start Screen Styles */
        #start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--off-white);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            transition: opacity 0.5s ease, transform 0.5s ease;
            padding: 40px;
        }
        
        #start-screen.hidden {
            opacity: 0;
            transform: translateY(-50px);
            pointer-events: none;
        }
        
        .start-content {
            display: flex;
            align-items: flex-start;
            gap: 80px;
            margin-bottom: 80px;
            max-width: 1200px;
            width: 100%;
            justify-content: center;
        }
        
        .start-clippy {
            width: 200px;
            height: 200px;
            background: url('/static/images/clippy.png') no-repeat center;
            background-size: contain;
            animation: start-clippy-bounce 2s ease-in-out infinite;
            filter: drop-shadow(4px 4px 8px rgba(0,0,0,0.2));
            flex-shrink: 0;
        }
        
        .start-welcome {
            max-width: 500px;
            flex: 1;
        }
        
        .clippy-bubble {
            background: white;
            border: 2px solid var(--ms-blue);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            position: relative;
            box-shadow: 0 4px 15px rgba(0, 120, 212, 0.2);
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        .clippy-bubble::before {
            content: '';
            position: absolute;
            left: -12px;
            top: 30px;
            width: 0;
            height: 0;
            border-top: 12px solid transparent;
            border-bottom: 12px solid transparent;
            border-right: 12px solid var(--ms-blue);
        }
        
        .clippy-bubble::after {
            content: '';
            position: absolute;
            left: -10px;
            top: 30px;
            width: 0;
            height: 0;
            border-top: 10px solid transparent;
            border-bottom: 10px solid transparent;
            border-right: 10px solid white;
        }
        
        @keyframes start-clippy-bounce {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        
        .start-title {
            font-size: 3rem;
            font-weight: 300;
            color: var(--ms-blue);
            text-align: center;
            margin-bottom: 20px;
        }
        
        .start-subtitle {
            font-size: 1.3rem;
            color: var(--ms-gray);
            margin-bottom: 40px;
            text-align: center;
            opacity: 0.8;
        }
        
        .start-button {
            background: linear-gradient(135deg, var(--ms-blue) 0%, var(--ms-blue-dark) 100%);
            color: white;
            border: none;
            padding: 20px 50px;
            font-size: 1.4rem;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(0, 120, 212, 0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
            display: block;
            margin: 0 auto;
        }
        
        .start-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 120, 212, 0.4);
            background: linear-gradient(135deg, var(--ms-blue-dark) 0%, #0b5394 100%);
        }
        
        /* Main App Styles */
        #main-app {
            opacity: 0;
            transform: translateY(50px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        #main-app.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        .header { 
            text-align: center; 
            color: var(--ms-blue); 
            margin-bottom: 40px; 
            position: relative;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .header h1 { 
            font-size: 3rem; 
            margin-bottom: 10px; 
            font-weight: 300;
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.8;
            font-weight: 300;
        }
        
        .main-panel { 
            background: white; 
            border-radius: 15px; 
            padding: 30px; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); 
            margin-bottom: 30px;
            border: 1px solid #e8e8e8;
        }
        
        .form-section { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 30px; 
            margin-bottom: 30px; 
        }
        
        .form-group { display: flex; flex-direction: column; }
        
        .form-group label { 
            font-weight: 600; 
            margin-bottom: 8px; 
            color: var(--ms-gray); 
            font-size: 1.1rem; 
        }
        
        .form-group select { 
            padding: 12px; 
            border: 2px solid #e8e8e8; 
            border-radius: 8px; 
            font-size: 1rem;
            background: white;
            color: var(--ms-gray);
            font-family: 'Segoe UI', sans-serif;
        }
        
        .form-group select:focus {
            outline: none;
            border-color: var(--ms-blue);
            box-shadow: 0 0 0 2px rgba(0, 120, 212, 0.2);
        }
        
        .run-button { 
            background: linear-gradient(135deg, var(--ms-blue) 0%, var(--ms-blue-dark) 100%); 
            color: white; 
            border: none; 
            padding: 15px 40px; 
            font-size: 1.2rem; 
            font-weight: 600; 
            border-radius: 50px; 
            cursor: pointer; 
            margin: 20px auto; 
            display: block;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 120, 212, 0.3);
        }
        
        .run-button:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 8px 25px rgba(0, 120, 212, 0.4); 
        }
        
        .status-panel { 
            background: white; 
            border-radius: 10px; 
            padding: 20px; 
            margin-top: 20px; 
            display: none;
            border: 1px solid #e8e8e8;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .status-info {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .eta-display {
            background: var(--earth-warm);
            border: 1px solid var(--earth-sage);
            border-radius: 12px;
            padding: 8px 16px;
            font-size: 0.9rem;
            color: var(--ms-gray);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .eta-display .time {
            font-weight: 600;
            color: var(--earth-forest);
        }
        
        .progress-bar { 
            width: 100%; 
            height: 10px; 
            background: #e8e8e8; 
            border-radius: 5px; 
            overflow: hidden; 
            margin: 10px 0; 
        }
        
        .progress-fill { 
            height: 100%; 
            background: linear-gradient(90deg, var(--ms-blue), var(--earth-sage)); 
            width: 0%; 
            transition: width 0.3s ease; 
        }
        
        .logs { 
            background: var(--ms-gray); 
            color: white; 
            padding: 15px; 
            border-radius: 8px; 
            font-family: 'Consolas', monospace; 
            font-size: 0.9rem; 
            max-height: 200px; 
            overflow-y: auto; 
            margin-top: 10px; 
        }
        
        .results-panel { 
            display: none; 
            background: white; 
            border-radius: 15px; 
            padding: 30px; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); 
            margin-top: 20px;
            border: 1px solid #e8e8e8;
        }
        
        .result-cards { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px; 
            margin: 20px 0; 
        }
        
        .result-card { 
            background: var(--off-white); 
            padding: 20px; 
            border-radius: 10px; 
            border-left: 4px solid var(--ms-blue);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .download-btn { 
            background: var(--ms-blue); 
            color: white; 
            padding: 10px 20px; 
            border: none; 
            border-radius: 25px; 
            text-decoration: none; 
            font-weight: 500; 
            margin: 5px; 
            display: inline-block;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 120, 212, 0.3);
        }
        
        .download-btn:hover { 
            background: var(--ms-blue-dark); 
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 120, 212, 0.4);
        }
        
        .status-badge { 
            padding: 5px 12px; 
            border-radius: 15px; 
            font-size: 0.8rem; 
            font-weight: 600; 
        }
        
        .status-completed { background: var(--earth-sage); color: white; }
        .status-failed { background: var(--earth-clay); color: white; }
        .status-running { background: var(--earth-stone); color: white; }
        
        h2, h3 {
            color: var(--ms-gray);
            font-weight: 400;
        }
        
        h2:before {
            content: '🌿 ';
        }
        
        /* Microsoft-style focus states */
        button:focus, select:focus {
            outline: 2px solid var(--ms-blue);
            outline-offset: 2px;
        }
        
        /* Clippy Fixed Position - Improved UI */
        #clippy-fixed {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            width: 120px;
            height: auto;
            background: none;
            box-shadow: none;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .clippy-bubble-bottom {
            background: #fff;
            border: 2px solid var(--ms-blue);
            border-radius: 24px;
            padding: 24px;
            margin-bottom: 16px;
            max-width: 400px;
            min-width: 320px;
            font-size: 1rem;
            box-shadow: 0 8px 32px rgba(0,120,212,0.18);
            position: relative;
            word-break: break-word;
            overflow: hidden;
            display: none;
        }

        .clippy-bubble-bottom.show {
            display: block;
            animation: bubbleSlideIn 0.3s ease-out;
        }

        @keyframes bubbleSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .clippy-messages {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 16px;
            line-height: 1.5;
        }

        .message {
            margin-bottom: 12px;
            padding: 8px 0;
        }

        .message.user {
            color: var(--ms-blue);
            font-weight: 600;
        }

        .message.clippy {
            color: var(--ms-gray);
        }

        .clippy-input-area {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .clippy-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            font-size: 0.9rem;
            outline: none;
            transition: border-color 0.2s;
        }

        .clippy-input:focus {
            border-color: var(--ms-blue);
        }

        .clippy-send-btn {
            background: var(--ms-blue);
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .clippy-send-btn:hover {
            background: var(--ms-blue-dark);
        }

        .clippy-image {
            width: 120px;
            height: auto;
            cursor: pointer;
            transition: transform 0.2s;
            filter: drop-shadow(2px 2px 8px rgba(0,0,0,0.1));
        }

        .clippy-image:hover {
            transform: scale(1.05);
        }

        .clippy-bubble-bottom::before {
            content: '';
            position: absolute;
            bottom: -10px;
            right: 40px;
            width: 0;
            height: 0;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-top: 12px solid var(--ms-blue);
        }

        .clippy-bubble-bottom::after {
            content: '';
            position: absolute;
            bottom: -8px;
            right: 40px;
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid white;
        }

        /* Responsive Design */
        
        /* Ultrawide monitors (1920px+) */
        @media (min-width: 1920px) {
            .container {
                max-width: 1600px;
            }
            
            .start-content {
                gap: 120px;
            }
            
            .header h1 {
                font-size: 4rem;
            }
            
            .form-section {
                grid-template-columns: repeat(3, 1fr);
                gap: 40px;
            }
        }

        /* Standard desktop (1440px+) */
        @media (min-width: 1440px) and (max-width: 1919px) {
            .container {
                max-width: 1300px;
            }
            
            .start-content {
                gap: 100px;
            }
        }

        /* Tablet landscape and smaller desktop */
        @media (max-width: 1024px) {
            .container {
                padding: 15px;
            }
            
            .start-content {
                flex-direction: column;
                align-items: center;
                gap: 40px;
                text-align: center;
            }
            
            .start-clippy {
                width: 150px;
                height: 150px;
            }
            
            .start-title {
                font-size: 2.5rem;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
            
            .form-section {
                grid-template-columns: 1fr 1fr;
                gap: 20px;
            }
            
            .clippy-bubble-bottom {
                max-width: 300px;
                min-width: 250px;
            }
        }

        /* Tablet portrait */
        @media (max-width: 768px) {
            .user-profile {
                right: 15px;
                top: 15px;
                padding: 6px 12px;
            }
            
            .microsoft-logo {
                right: 15px;
                top: 70px;
                width: 35px;
                height: 35px;
            }
            
            .ms-square {
                width: 16px;
                height: 16px;
            }
            
            .home-button {
                left: 15px;
                top: 15px;
                width: 45px;
                height: 45px;
                font-size: 1.3rem;
            }
            
            .start-title {
                font-size: 2rem;
            }
            
            .start-subtitle {
                font-size: 1.1rem;
            }
            
            .start-button {
                padding: 15px 35px;
                font-size: 1.2rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .form-section {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .main-panel {
                padding: 20px;
            }
            
            .result-cards {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            #clippy-fixed {
                bottom: 20px;
                right: 20px;
                width: 100px;
            }
            
            .clippy-image {
                width: 100px;
            }
            
            .clippy-bubble-bottom {
                max-width: calc(100vw - 40px);
                min-width: calc(100vw - 40px);
                right: -200px;
            }
        }

        /* Mobile phones */
        @media (max-width: 480px) {
            .user-info {
                display: none;
            }
            
            .user-profile {
                padding: 8px;
                border-radius: 50%;
                width: 48px;
                height: 48px;
            }
            
            .start-content {
                padding: 20px;
            }
            
            .start-clippy {
                width: 120px;
                height: 120px;
            }
            
            .clippy-bubble {
                font-size: 1rem;
                padding: 20px;
            }
            
            .start-title {
                font-size: 1.8rem;
            }
            
            .start-subtitle {
                font-size: 1rem;
            }
            
            .start-button {
                padding: 12px 25px;
                font-size: 1rem;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .main-panel {
                padding: 15px;
            }
            
            .form-group label {
                font-size: 1rem;
            }
            
            .run-button {
                padding: 12px 30px;
                font-size: 1rem;
            }
            
            .download-btn {
                padding: 8px 15px;
                font-size: 0.9rem;
                margin: 3px;
            }
            
            #clippy-fixed {
                bottom: 15px;
                right: 15px;
                width: 80px;
            }
            
            .clippy-image {
                width: 80px;
            }
            
            .clippy-bubble-bottom {
                max-width: calc(100vw - 30px);
                min-width: calc(100vw - 30px);
                right: -220px;
                font-size: 0.9rem;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Home Button -->
    <button class="home-button" id="homeButton">🏠</button>

    <!-- Microsoft Logo -->
    <div class="microsoft-logo">
        <div class="ms-square"></div>
        <div class="ms-square"></div>
        <div class="ms-square"></div>
        <div class="ms-square"></div>
    </div>

    <!-- User Profile -->
    <div class="user-profile">
        <div class="user-avatar">DB</div>
        <div class="user-info">
            <div class="user-name">Donny Badamo</div>
            <div class="user-email">donny@badamobusiness.com</div>
        </div>
    </div>

    <!-- Start Screen -->
    <div id="start-screen">
        <div class="start-content">
            <div class="start-clippy"></div>
            <div class="start-welcome">
                <div class="clippy-bubble">
                    Hi there! I'm Clippy, your AI content assistant. Welcome to Microsoft C.R.E.A.T.E.! I'm here to help you craft amazing content strategies that will grow your digital presence. Ready to get started? 📎✨
                </div>
            </div>
        </div>
        
        <div>
            <h1 class="start-title">🌿 Microsoft C.R.E.A.T.E.</h1>
            <p class="start-subtitle">AI Content Pipeline - Natural Intelligence for Digital Growth</p>
            <button class="start-button" id="startButton">Get Started</button>
        </div>
    </div>

    <!-- Main Application -->
    <div id="main-app">
        <div class="container">
            <div class="header">
                <h1>🌿 Microsoft C.R.E.A.T.E.</h1>
                <p>AI Content Pipeline - Natural Intelligence for Digital Growth</p>
            </div>
            
            <div class="main-panel">
                <h2>Configure Your Content Strategy</h2>
                <div class="form-section">
                    <div class="form-group">
                        <label for="platform">📱 Target Platform</label>
                        <select id="platform">
                            <option value="tiktok">TikTok</option>
                            <option value="instagram">Instagram</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="audience">👥 Target Audience</label>
                        <select id="audience">
                            <option value="employees">Employees</option>
                            <option value="managers">Managers</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="product">🏢 Microsoft Product</label>
                        <select id="product">
                            <option value="teams">Microsoft Teams</option>
                            <option value="office">Microsoft Office</option>
                            <option value="365">Microsoft 365</option>
                        </select>
                    </div>
                </div>
                
                <button class="run-button" id="runPipeline">
                    <span>🌱</span> Cultivate Content Strategy
                </button>
            </div>
            
            <div class="status-panel" id="statusPanel">
                <div class="status-header">
                    <h3>🌾 Pipeline Growing</h3>
                    <span id="statusBadge" class="status-badge status-running">Nurturing</span>
                </div>
                <div class="status-info">
                    <div class="eta-display">
                        ⏳ Estimated Time: <span class="time" id="etaTime">Calculating...</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div id="currentStage">Planting seeds...</div>
                <div class="logs" id="logs"></div>
            </div>
            
            <div class="results-panel" id="resultsPanel">
                <h2>🌟 Your Content Harvest</h2>
                <div class="result-cards">
                    <div class="result-card">
                        <h3>🌱 Top Trending Opportunity</h3>
                        <div id="topTrend"></div>
                    </div>
                    <div class="result-card">
                        <h3>⏱️ Growth Time</h3>
                        <div id="executionTime"></div>
                    </div>
                    <div class="result-card">
                        <h3>📝 Content Seeds Planted</h3>
                        <div id="scriptsCount"></div>
                    </div>
                </div>
                
                <h3>🎬 Ready-to-Bloom Content Scripts</h3>
                <div id="scriptsPreview"></div>
                
                <div style="margin-top: 20px;">
                    <a href="#" class="download-btn" id="viewReport">📖 View Executive Garden Plan</a>
                    <a href="#" class="download-btn" id="downloadExec">🌿 Download Strategy Guide</a>
                    <a href="#" class="download-btn" id="downloadTech">📊 Download Growth Data</a>
                    <a href="#" class="download-btn" id="downloadQuick">⚡ Download Quick Start</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Clippy Fixed Position - Improved -->
    <div id="clippy-fixed">
        <div id="clippy-bubble" class="clippy-bubble-bottom">
            <div id="clippy-messages" class="clippy-messages">
            </div>
            <form id="clippy-chat-form" class="clippy-input-area">
                <input type="text" id="clippy-input" class="clippy-input" placeholder="Ask me anything...">
                <button type="submit" class="clippy-send-btn">→</button>
            </form>
        </div>
        <img src="/static/images/clippy.png" alt="Clippy" class="clippy-image" id="clippy-toggle">
    </div>

    <script>
        let currentPipelineId = null;
        let statusCheckInterval = null;
        let chatOpen = false;

        // Clippy chat functionality
        const clippyToggle = document.getElementById('clippy-toggle');
        const clippyBubble = document.getElementById('clippy-bubble');
        const clippyInput = document.getElementById('clippy-input');
        const clippyMessagesElem = document.getElementById('clippy-messages');
        const clippyChatForm = document.getElementById('clippy-chat-form');

        // Home button functionality
        const homeButton = document.getElementById('homeButton');
        const startScreen = document.getElementById('start-screen');
        const mainApp = document.getElementById('main-app');

        homeButton.addEventListener('click', function() {
            // Show start screen
            startScreen.classList.remove('hidden');
            mainApp.classList.remove('visible');
            homeButton.classList.remove('visible');
            
            // Reset any running processes
            if (statusCheckInterval) {
                clearInterval(statusCheckInterval);
                statusCheckInterval = null;
            }
            
            // Hide status and results panels
            document.getElementById('statusPanel').style.display = 'none';
            document.getElementById('resultsPanel').style.display = 'none';
            
            // Reset button
            resetRunButton();
            
            if (chatOpen) {
                addMessage('clippy', "Welcome back! Ready to create more amazing content strategies? 🏠✨");
            }
        });

        // Toggle chat bubble
        clippyToggle.addEventListener('click', function() {
            chatOpen = !chatOpen;
            if (chatOpen) {
                clippyBubble.classList.add('show');
                clippyInput.focus();
            } else {
                clippyBubble.classList.remove('show');
            }
        });

        // Add message to chat
        function addMessage(sender, text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.innerHTML = sender === 'user' ? `<strong>You:</strong> ${text}` : `<strong>Clippy:</strong> ${text}`;
            clippyMessagesElem.appendChild(messageDiv);
            clippyMessagesElem.scrollTop = clippyMessagesElem.scrollHeight;
        }

        // Chat form submission
        clippyChatForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const userMessage = clippyInput.value.trim();
            if (!userMessage) return;

            addMessage('user', userMessage);
            clippyInput.value = '';

            // Generate Clippy response
            setTimeout(() => {
                const response = generateClippyResponse(userMessage);
                addMessage('clippy', response);
            }, 500);
        });

        // Generate Clippy responses
        function generateClippyResponse(message) {
            const lowerMsg = message.toLowerCase();
            
            if (lowerMsg.includes('hello') || lowerMsg.includes('hi')) {
                return "Hello! I'm here to help you create amazing content strategies. What would you like to know? 😊";
            } else if (lowerMsg.includes('what') && (lowerMsg.includes('this') || lowerMsg.includes('create'))) {
                return "Microsoft C.R.E.A.T.E. is your AI-powered content strategy assistant! We help you plan, create, and optimize content for social media platforms like TikTok and Instagram. 🚀";
            } else if (lowerMsg.includes('how') && lowerMsg.includes('work')) {
                return "Great question! Simply select your target platform, audience, and Microsoft product above, then click 'Cultivate Content Strategy'. I'll generate personalized content ideas and scripts for you! 🌱";
            } else if (lowerMsg.includes('platform') || lowerMsg.includes('tiktok') || lowerMsg.includes('instagram')) {
                return "We currently support TikTok and Instagram! Each platform has unique content styles and audience preferences that our AI takes into account. 📱";
            } else if (lowerMsg.includes('help') || lowerMsg.includes('support')) {
                return "I'm here to help! You can ask me about how C.R.E.A.T.E. works, content strategy tips, or any questions about the platform selection above. 💡";
            } else if (lowerMsg.includes('thanks') || lowerMsg.includes('thank you')) {
                return "You're very welcome! I'm always happy to help you grow your content strategy. Feel free to ask me anything else! 🙌";
            } else if (lowerMsg.includes('strategy') || lowerMsg.includes('content')) {
                return "Content strategy is all about creating the right content for the right audience at the right time! Our AI analyzes trends, audience preferences, and platform algorithms to give you the best recommendations. 📈";
            } else if (lowerMsg.includes('home') || lowerMsg.includes('start')) {
                return "You can click the home button (🏠) in the top-left corner anytime to return to the start screen! 🏠";
            } else {
                const responses = [
                    "That's interesting! Tell me more about what you'd like to know about content strategy. 🤔",
                    "I'm here to help with your content strategy needs! Feel free to ask about platforms, audiences, or how our AI works. ✨",
                    "Great question! Is there something specific about content creation or our platform you'd like to explore? 🌟",
                    "I'd love to help you with that! Can you tell me more about what you're looking for? 💭"
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }
        }

        // Start screen functionality
        document.getElementById('startButton').addEventListener('click', function() {
            startScreen.classList.add('hidden');
            
            setTimeout(() => {
                mainApp.classList.add('visible');
                homeButton.classList.add('visible');
                
                // Show Clippy chat with welcome message as the FIRST message
                chatOpen = true;
                clippyBubble.classList.add('show');
                addMessage('clippy', "Perfect! Now you can configure your content strategy. Choose your platform, audience, and Microsoft product to get started! 🌱");
            }, 250);
        });

        function loadHistory() {
            console.log('Loading history...');
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadHistory();
        });

        document.getElementById('runPipeline').addEventListener('click', async function() {
            const platform = document.getElementById('platform').value;
            const audience = document.getElementById('audience').value;
            const product = document.getElementById('product').value;
            
            // Add message to chat if open
            if (chatOpen) {
                addMessage('clippy', `Perfect! I'm cultivating your ${platform} content strategy for ${audience} using ${product}! This is going to be amazing! 🌱✨`);
            }
            
            const runButton = this;
            runButton.disabled = true;
            runButton.innerHTML = '<span>🌱</span> Planting Your Strategy...';
            
            try {
                const response = await fetch('/api/run-pipeline', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({platform, audience, product})
                });
                
                const data = await response.json();
                currentPipelineId = data.pipeline_id;
                
                document.getElementById('statusPanel').style.display = 'block';
                document.getElementById('resultsPanel').style.display = 'none';
                
                startStatusMonitoring();
                
            } catch (error) {
                if (chatOpen) {
                    addMessage('clippy', "Oops! Something went wrong with the cultivation process. Let me help you try again! 🔧");
                }
                alert('Error planting strategy: ' + error.message);
                runButton.disabled = false;
                runButton.innerHTML = '<span>🌱</span> Cultivate Content Strategy';
            }
        });

        function startStatusMonitoring() {
            statusCheckInterval = setInterval(async () => {
                if (!currentPipelineId) return;
                
                try {
                    const response = await fetch(`/api/pipeline-status/${currentPipelineId}`);
                    const status = await response.json();
                    
                    updateStatusDisplay(status);
                    
                    if (status.status === 'completed' || status.status === 'failed') {
                        clearInterval(statusCheckInterval);
                        if (status.status === 'completed') {
                            if (chatOpen) {
                                addMessage('clippy', "🎉 Amazing! Your content strategy has bloomed beautifully! Check out all the fantastic results below - I think you're going to love what we've created together!");
                            }
                            await loadResults();
                        } else {
                            if (chatOpen) {
                                addMessage('clippy', "Don't worry! Even the best gardens need replanting sometimes. Let's try again - I'm here to help! 🌱");
                            }
                        }
                        resetRunButton();
                    }
                } catch (error) {
                    console.error('Error checking growth status:', error);
                }
            }, 2000);
        }

        function updateStatusDisplay(status) {
            const progressFill = document.getElementById('progressFill');
            const statusBadge = document.getElementById('statusBadge');
            const currentStage = document.getElementById('currentStage');
            const logs = document.getElementById('logs');
            const etaTime = document.getElementById('etaTime');
            
            progressFill.style.width = (status.progress || 0) + '%';
            
            let statusText = status.status;
            if (status.status === 'running') statusText = 'Growing';
            if (status.status === 'completed') statusText = 'Bloomed';
            if (status.status === 'failed') statusText = 'Needs Care';
            
            statusBadge.textContent = statusText;
            statusBadge.className = 'status-badge status-' + status.status;
            
            let stageText = status.stage || 'Nurturing growth...';
            currentStage.textContent = stageText;
            
            if (status.logs) {
                logs.innerHTML = status.logs.map(log => `<div>${log}</div>`).join('');
                logs.scrollTop = logs.scrollHeight;
            }
            
            // Update ETA display
            if (status.eta) {
                etaTime.textContent = formatETA(status.eta);
                document.querySelector('.eta-display').style.display = 'flex';
            } else {
                document.querySelector('.eta-display').style.display = 'none';
            }
        }

        function formatETA(eta) {
            const minutes = Math.floor(eta / 60);
            const seconds = eta % 60;
            return `${minutes}m ${seconds}s`;
        }

        async function loadResults() {
            try {
                const response = await fetch(`/api/pipeline-result/${currentPipelineId}`);
                const result = await response.json();
                
                if (result.success) {
                    displayResults(result);
                    document.getElementById('resultsPanel').style.display = 'block';
                } else {
                    alert('Strategy needs more nurturing: ' + result.error);
                }
            } catch (error) {
                console.error('Error harvesting results:', error);
            }
        }

        function displayResults(result) {
            document.getElementById('topTrend').innerHTML = `
                <strong>🌟 ${result.top_trend?.name || 'Growing Opportunity'}</strong><br>
                <small>Growth Score: ${result.top_trend?.overallScore || 'Assessing'}/10</small>
            `;
            
            document.getElementById('executionTime').textContent = result.execution_time || 'Natural timing';
            document.getElementById('scriptsCount').textContent = result.content_scripts?.length || 0;
            
            const scriptsPreview = document.getElementById('scriptsPreview');
            if (result.content_scripts) {
                scriptsPreview.innerHTML = result.content_scripts.slice(0, 3).map((script, i) => `
                    <div style="background: var(--off-white); padding: 15px; border-radius: 8px; margin: 10px 0; border: 1px solid #e8e8e8; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
                        <h4>🌱 ${i + 1}. ${script.title}</h4>
                        <p><strong>Category:</strong> ${script.category}</p>
                        <p><strong>Hook:</strong> "${script.hook}"</p>
                        <p><strong>Growth Tags:</strong> ${script.hashtags?.join(', ') || 'Organic reach'}</p>
                    </div>
                `).join('');
            }
            
            const pipelineId = result.pipeline_id;
            document.getElementById('viewReport').href = `/view-report/${pipelineId}`;
            document.getElementById('downloadExec').href = `/download/${pipelineId}/executive`;
            document.getElementById('downloadTech').href = `/download/${pipelineId}/technical`;
            document.getElementById('downloadQuick').href = `/download/${pipelineId}/quick`;
        }

        function resetRunButton() {
            const runButton = document.getElementById('runPipeline');
            runButton.disabled = false;
            runButton.innerHTML = '<span>🌱</span> Cultivate Content Strategy';
        }

        // Close chat when clicking outside
        document.addEventListener('click', function(event) {
            if (chatOpen && !document.getElementById('clippy-fixed').contains(event.target)) {
                chatOpen = false;
                clippyBubble.classList.remove('show');
            }
        });
    </script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>